"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const database_1 = require("./models/database");
const express = require("express");
const path = require("path");
const bodyParser = require("body-parser");
const cookieParser = require("cookie-parser");
const nocache = require("nocache");
const configs_1 = require("./configs");
const uuid_1 = require("uuid");
const user_model_1 = require("./models/user-model");
const private_executor_model_1 = require("./models/private_executor-model");
const execution_district_model_1 = require("./models/execution_district-model");
const journal_event_model_1 = require("./models/journal_event-model");
const typeorm_1 = require("typeorm");
async function getLoggedUser(req) {
    if (req.cookies[configs_1.cookieName] == undefined || req.cookies[configs_1.cookieName] == "")
        return;
    return user_model_1.User.findOne(JSON.parse(decodeURIComponent(req.cookies[configs_1.cookieName])).login);
}
const app = express();
app.use(nocache());
app.set('view engine', 'ejs');
app.use(cookieParser());
app.use(bodyParser.urlencoded({ extended: true, limit: 3000000 }));
app.use(bodyParser.json({ limit: 3000000 }));
app.use(bodyParser.text({ limit: 30000000 }));
app.use(express.static(path.join(__dirname, 'static')));
app.use((req, res, next) => {
    res.set('Cache-Control', 'no-store');
    next();
});
app.get('/', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    const role = (loggedUser == undefined) ? 0 : loggedUser.role;
    const { fullname, district_id, is_active, certificate_num } = req.query;
    let searchObj = {};
    if (fullname != undefined && fullname != "")
        searchObj.fullname = typeorm_1.Like('%' + fullname + '%');
    if (certificate_num != undefined && certificate_num != "")
        searchObj.certificate_num = typeorm_1.Like('%' + certificate_num + '%');
    if (district_id != undefined)
        searchObj.district_id = district_id;
    if (is_active != undefined)
        searchObj.is_active = is_active;
    const privateExecutors = (Object.keys(searchObj).length > 0) ? (await private_executor_model_1.PrivateExecutor.find({
        where: searchObj,
        relations: ["district"]
    })) : [];
    console.log(privateExecutors);
    res.render('pages/main', {
        role,
        fullname, district_id, is_active, certificate_num,
        districts: await execution_district_model_1.ExecutionDistrict.find(),
        privateExecutors: privateExecutors
    });
});
app.get('/login', (req, res) => {
    res.render('pages/login');
});
app.get('/priv-exec/list', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    if (loggedUser == undefined)
        return res.redirect('/error/permission-denied');
    res.render('pages/priv-exec-list', {
        role: loggedUser.role,
        privateExecutors: await private_executor_model_1.PrivateExecutor.find({
            relations: ['user'],
            where: {
                user: {
                    login: loggedUser.login
                }
            }
        })
    });
});
app.get('/registrator/list', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    if (loggedUser == undefined)
        return res.redirect('/error/permission-denied');
    res.render('pages/registrator-list', {
        role: loggedUser.role,
        registers: await user_model_1.User.find({ where: { role: 1 } })
    });
});
app.get('/event-journal', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    if (loggedUser == undefined)
        return res.redirect('/error/permission-denied');
    const events = await journal_event_model_1.JournalEvent.find({
        relations: ['user'],
        where: {
            user: {
                login: loggedUser.login
            }
        },
        order: {
            event_date: "DESC"
        }
    });
    res.render('pages/event-journal', { role: loggedUser.role, events });
});
app.get('/priv-exec/new', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    if (loggedUser == undefined)
        return res.redirect('/error/permission-denied');
    res.render('pages/priv-exec-new', { role: loggedUser.role, districts: await execution_district_model_1.ExecutionDistrict.find() });
});
app.get('/priv-exec/:id/edit', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    const oldPrivExecVal = await private_executor_model_1.PrivateExecutor.findOne({
        where: {
            id: req.params.id
        },
        relations: ["district"]
    });
    if (loggedUser == undefined || oldPrivExecVal == undefined)
        return res.redirect('/error/permission-denied');
    res.render('pages/priv-exec-edit', { role: loggedUser.role, oldPrivExecVal, districts: await execution_district_model_1.ExecutionDistrict.find() });
});
app.get('/registrator/new', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    if (loggedUser == undefined)
        return res.redirect('/error/permission-denied');
    res.render('pages/registrator-new', { role: loggedUser.role });
});
app.get('/registrator/:login/edit', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    const oldUserVal = await user_model_1.User.findOne(req.params.login);
    if (loggedUser == undefined || oldUserVal == undefined)
        return res.redirect('/error/permission-denied');
    res.render('pages/registrator-edit', { role: loggedUser.role, oldUserVal });
});
app.get('/error/permission-denied', async (req, res) => {
    const loggedUser = await getLoggedUser(req);
    const role = (loggedUser == undefined) ? 0 : loggedUser.role;
    res.render('pages/error', { role });
});
app.post('/api/auth/login', async (req, res) => {
    const { login, password } = JSON.parse(req.body);
    const userData = await user_model_1.User.findOne(login);
    if (userData != undefined && userData.pwd_hash == password && userData.is_active == true) {
        res.cookie(configs_1.cookieName, JSON.stringify({ login, password }), configs_1.cookieOptions);
        res.status(200).send();
    }
    else {
        res.status(400).send();
    }
});
app.post('/api/auth/logout', async (req, res) => {
    res.clearCookie(configs_1.cookieName, configs_1.cookieOptions);
    res.status(200).send();
});
app.post('/api/user', async (req, res) => {
    const { fullname, additional_data } = JSON.parse(req.body);
    const identificationData = {
        login: uuid_1.v1(),
        password: uuid_1.v4()
    };
    if (await user_model_1.User.findOne({ fullname }) == undefined) {
        const user = new user_model_1.User();
        user.login = identificationData.login;
        user.pwd_hash = identificationData.password;
        user.fullname = fullname;
        user.role = 1;
        user.date_registration = (new Date()).toISOString();
        user.is_active = true;
        user.additional_data = additional_data;
        await user.save();
        res.json(identificationData);
    }
    else {
        res.status(400).send();
    }
});
app.post('/api/user/:login/res_id', async (req, res) => {
    const user = await user_model_1.User.findOne(req.params.login);
    if (user == undefined) {
        return res.status(400).send();
    }
    user.login = uuid_1.v1();
    user.pwd_hash = uuid_1.v4();
    await user.save();
    res.status(200).send();
});
app.put('/api/user/:login', async (req, res) => {
    const { fullname, additional_data, is_active } = JSON.parse(req.body);
    const user = await user_model_1.User.findOne(req.params.login);
    if (user == undefined) {
        return res.status(400).send();
    }
    if (fullname != undefined)
        user.fullname = fullname;
    if (is_active != undefined)
        user.is_active = is_active;
    if (additional_data != undefined)
        user.additional_data = additional_data;
    await user.save();
    res.status(200).send();
});
app.delete('/api/user/:login', async (req, res) => {
    await user_model_1.User.remove(req.params.login);
    res.status(200).send();
});
app.post('/api/priv-exec', async (req, res) => {
    const { fullname, district_id, certificate_num, rec_certif_on, office_addr, started_out_on } = JSON.parse(req.body);
    const user = await getLoggedUser(req);
    console.log(JSON.parse(req.body));
    if (await private_executor_model_1.PrivateExecutor.findOne({ fullname }) == undefined) {
        const privExec = new private_executor_model_1.PrivateExecutor();
        privExec.fullname = fullname;
        privExec.user = user;
        privExec.district = await execution_district_model_1.ExecutionDistrict.findOne(Number(district_id));
        privExec.is_active = true;
        privExec.created_on = (new Date()).toISOString();
        privExec.certificate_num = certificate_num;
        privExec.rec_certif_on = rec_certif_on;
        privExec.office_addr = office_addr;
        privExec.started_out_on = started_out_on;
        await privExec.save();
        res.status(200).send();
    }
    else {
        res.status(400).send();
    }
});
app.put('/api/priv-exec/:id', async (req, res) => {
    const { fullname, district_id, certificate_num, rec_certif_on, office_addr, started_out_on, is_active } = JSON.parse(req.body);
    const privExec = await private_executor_model_1.PrivateExecutor.findOne(req.params.id);
    if (privExec == undefined) {
        return res.status(400).send();
    }
    if (fullname != undefined)
        privExec.fullname = fullname;
    if (district_id != undefined)
        privExec.district = await execution_district_model_1.ExecutionDistrict.findOne(Number(district_id));
    if (certificate_num != undefined)
        privExec.certificate_num = certificate_num;
    if (rec_certif_on != undefined)
        privExec.rec_certif_on = rec_certif_on;
    if (office_addr != undefined)
        privExec.office_addr = office_addr;
    if (started_out_on != undefined)
        privExec.started_out_on = started_out_on;
    if (is_active != undefined)
        privExec.is_active = is_active;
    await privExec.save();
    res.status(200).send();
});
app.delete('/api/priv-exec/:id', async (req, res) => {
    await private_executor_model_1.PrivateExecutor.remove(req.params.id);
    res.status(200).send();
});
app.use((err, req, resp, next) => {
    console.log(err);
    resp.status(500).send('ERROR');
});
process.on('SIGINT', async () => (await database_1.default).close().then(() => process.exit()));
(async function () {
    const connection = await database_1.default;
    //await connection.synchronize();
    app.listen(process.env.PORT || 5000, () => {
        console.log("Started server!");
    });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxnREFBa0Q7QUFDbEQsbUNBQW1DO0FBQ25DLDZCQUE2QjtBQUM3QiwwQ0FBMEM7QUFDMUMsOENBQThDO0FBQzlDLG1DQUFtQztBQUVuQyx1Q0FBc0Q7QUFDdEQsK0JBQWtEO0FBRWxELG9EQUEyQztBQUMzQyw0RUFBa0U7QUFDbEUsZ0ZBQXNFO0FBQ3RFLHNFQUE0RDtBQUc1RCxxQ0FBc0M7QUFHdEMsS0FBSyxVQUFVLGFBQWEsQ0FBQyxHQUFvQjtJQUNoRCxJQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsb0JBQVUsQ0FBQyxJQUFJLFNBQVMsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLG9CQUFVLENBQUMsSUFBSSxFQUFFO1FBQ3ZFLE9BQU87SUFFUixPQUFPLGlCQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxvQkFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3BGLENBQUM7QUFFRCxNQUFNLEdBQUcsR0FBd0IsT0FBTyxFQUFFLENBQUM7QUFFM0MsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0FBQ25CLEdBQUcsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzlCLEdBQUcsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztBQUN4QixHQUFHLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDbkUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM3QyxHQUFHLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBRTlDLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFdkQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUU7SUFDekIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDckMsSUFBSSxFQUFFLENBQUM7QUFDVCxDQUFDLENBQUMsQ0FBQztBQUVILEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBcUIsRUFBRSxFQUFFO0lBQ3RELE1BQU0sVUFBVSxHQUFHLE1BQU0sYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRTVDLE1BQU0sSUFBSSxHQUFHLENBQUMsVUFBVSxJQUFJLFNBQVMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7SUFDNUQsTUFBTSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUM7SUFFeEUsSUFBSSxTQUFTLEdBQU8sRUFBRSxDQUFDO0lBRXZCLElBQUcsUUFBUSxJQUFFLFNBQVMsSUFBSSxRQUFRLElBQUUsRUFBRTtRQUFFLFNBQVMsQ0FBQyxRQUFRLEdBQUcsY0FBSSxDQUFDLEdBQUcsR0FBQyxRQUFRLEdBQUMsR0FBRyxDQUFDLENBQUM7SUFDcEYsSUFBRyxlQUFlLElBQUUsU0FBUyxJQUFJLGVBQWUsSUFBRSxFQUFFO1FBQUUsU0FBUyxDQUFDLGVBQWUsR0FBRyxjQUFJLENBQUMsR0FBRyxH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QUFFO0lBQ3RGLE1BQU0sd0NBQWUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUV6QyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQzNCLENBQUMsQ0FBQyxDQUFDO0FBR0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQVUsRUFBRSxHQUFvQixFQUFFLElBQXNCLEVBQUUsSUFBYyxFQUFDLEVBQUU7SUFDbkYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNqQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNoQyxDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLGtCQUFpQixDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFFOUYsQ0FBQyxLQUFLO0lBQ0wsTUFBTSxVQUFVLEdBQUcsTUFBTSxrQkFBaUIsQ0FBQztJQUMzQyxpQ0FBaUM7SUFFakMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJLEVBQUUsR0FBRyxFQUFFO1FBQ3pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY29ubmVjdGlvblByb21pc2UgZnJvbSAnLi9tb2RlbHMvZGF0YWJhc2UnO1xuaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0ICogYXMgYm9keVBhcnNlciBmcm9tIFwiYm9keS1wYXJzZXJcIjtcbmltcG9ydCAqIGFzIGNvb2tpZVBhcnNlciBmcm9tIFwiY29va2llLXBhcnNlclwiO1xuaW1wb3J0ICogYXMgbm9jYWNoZSBmcm9tIFwibm9jYWNoZVwiO1xuXG5pbXBvcnQgeyBjb29raWVPcHRpb25zLCBjb29raWVOYW1lIH0gZnJvbSBcIi4vY29uZmlnc1wiO1xuaW1wb3J0IHsgdjEgYXMgdXVpZFYxLCB2NCBhcyB1dWlkVjQgfSBmcm9tIFwidXVpZFwiO1xuXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSBcIi4vbW9kZWxzL3VzZXItbW9kZWxcIjtcbmltcG9ydCB7IFByaXZhdGVFeGVjdXRvciB9IGZyb20gXCIuL21vZGVscy9wcml2YXRlX2V4ZWN1dG9yLW1vZGVsXCI7XG5pbXBvcnQgeyBFeGVjdXRpb25EaXN0cmljdCB9IGZyb20gXCIuL21vZGVscy9leGVjdXRpb25fZGlzdHJpY3QtbW9kZWxcIjtcbmltcG9ydCB7IEpvdXJuYWxFdmVudCB9IGZyb20gXCIuL21vZGVscy9qb3VybmFsX2V2ZW50LW1vZGVsXCI7XG5cblxuaW1wb3J0IHsgTGlrZSwgRXF1YWwgfSBmcm9tIFwidHlwZW9ybVwiO1xuXG5cbmFzeW5jIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXIocmVxOiBleHByZXNzLlJlcXVlc3Qpe1xuXHRpZihyZXEuY29va2llc1tjb29raWVOYW1lXSA9PSB1bmRlZmluZWQgfHwgcmVxLmNvb2tpZXNbY29va2llTmFtZV0gPT0gXCJcIilcblx0XHRyZXR1cm47XG5cblx0cmV0dXJuIFVzZXIuZmluZE9uZShKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChyZXEuY29va2llc1tjb29raWVOYW1lXSkpLmxvZ2luKTtcbn1cblxuY29uc3QgYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uID0gZXhwcmVzcygpO1xuXG5hcHAudXNlKG5vY2FjaGUoKSk7XG5hcHAuc2V0KCd2aWV3IGVuZ2luZScsICdlanMnKTtcbmFwcC51c2UoY29va2llUGFyc2VyKCkpO1xuYXBwLnVzZShib2R5UGFyc2VyLnVybGVuY29kZWQoeyBleHRlbmRlZDogdHJ1ZSwgbGltaXQ6IDMwMDAwMDAgfSkpO1xuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oeyBsaW1pdDogMzAwMDAwMCB9KSk7XG5hcHAudXNlKGJvZHlQYXJzZXIudGV4dCh7IGxpbWl0OiAzMDAwMDAwMCB9KSk7XG5cbmFwcC51c2UoZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKF9fZGlybmFtZSwnc3RhdGljJykpKTtcblxuYXBwLnVzZSgocmVxLCByZXMsIG5leHQpID0+IHtcbiAgcmVzLnNldCgnQ2FjaGUtQ29udHJvbCcsICduby1zdG9yZScpO1xuICBuZXh0KCk7XG59KTtcblxuYXBwLmdldCgnLycsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG5cdGNvbnN0IGxvZ2dlZFVzZXIgPSBhd2FpdCBnZXRMb2dnZWRVc2VyKHJlcSk7XG5cblx0Y29uc3Qgcm9sZSA9IChsb2dnZWRVc2VyID09IHVuZGVmaW5lZCk/IDAgOiBsb2dnZWRVc2VyLnJvbGU7XG5cdGNvbnN0IHsgZnVsbG5hbWUsIGRpc3RyaWN0X2lkLCBpc19hY3RpdmUsIGNlcnRpZmljYXRlX251bSB9ID0gcmVxLnF1ZXJ5O1xuXG5cdGxldCBzZWFyY2hPYmo6YW55ID0ge307XG5cblx0aWYoZnVsbG5hbWUhPXVuZGVmaW5lZCAmJiBmdWxsbmFtZSE9XCJcIikgc2VhcmNoT2JqLmZ1bGxuYW1lID0gTGlrZSgnJScrZnVsbG5hbWUrJyUnKTtcblx0aWYoY2VydGlmaWNhdGVfbnVtIT11bmRlZmluZWQgJiYgY2VydGlmaWNhdGVfbnVtIT1cIlwiKSBzZWFyY2hPYmouY2VydGlmaWNhdGVfbnVtID0gTGlrZSgnJScrY2VydGlmaWNhdGVfbnVtKyclJyk7XG5cdGlmKGRpc3RyaWN0X2lkIT11bmRlZmluZWQpIHNlYXJjaE9iai5kaXN0cmljdF9pZCA9IGRpc3RyaWN0X2lkO1xuXHRpZihpc19hY3RpdmUhPXVuZGVmaW5lZCkgc2VhcmNoT2JqLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcblxuXHRjb25zdCBwcml2YXRlRXhlY3V0b3JzID0gKE9iamVjdC5rZXlzKHNlYXJjaE9iaikubGVuZ3RoPjApPyAoYXdhaXQgUHJpdmF0ZUV4ZWN1dG9yLmZpbmQoXG5cdFx0e1xuXHRcdFx0d2hlcmU6IHNlYXJjaE9iaixcblx0XHRcdHJlbGF0aW9uczogW1wiZGlzdHJpY3RcIl1cblx0XHR9KSkgOiBbXTtcblxuXHRjb25zb2xlLmxvZyhwcml2YXRlRXhlY3V0b3JzKTtcblxuXHRyZXMucmVuZGVyKCdwYWdlcy9tYWluJywge1xuXHRcdHJvbGUsXG5cdFx0ZnVsbG5hbWUsIGRpc3RyaWN0X2lkLCBpc19hY3RpdmUsIGNlcnRpZmljYXRlX251bSxcblx0XHRkaXN0cmljdHM6IGF3YWl0IEV4ZWN1dGlvbkRpc3RyaWN0LmZpbmQoKSxcblx0XHRwcml2YXRlRXhlY3V0b3JzOiBwcml2YXRlRXhlY3V0b3JzXG5cdH0pO1xufSk7XG5hcHAuZ2V0KCcvbG9naW4nLCAocmVxOiBhbnksIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRyZXMucmVuZGVyKCdwYWdlcy9sb2dpbicpO1xufSk7XG5hcHAuZ2V0KCcvcHJpdi1leGVjL2xpc3QnLCBhc3luYyAocmVxOiBhbnksIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRjb25zdCBsb2dnZWRVc2VyID0gYXdhaXQgZ2V0TG9nZ2VkVXNlcihyZXEpO1xuXG5cdGlmKGxvZ2dlZFVzZXIgPT0gdW5kZWZpbmVkKSByZXR1cm4gcmVzLnJlZGlyZWN0KCcvZXJyb3IvcGVybWlzc2lvbi1kZW5pZWQnKTtcblxuXHRyZXMucmVuZGVyKCdwYWdlcy9wcml2LWV4ZWMtbGlzdCcsIHtcblx0XHRyb2xlOiBsb2dnZWRVc2VyLnJvbGUsXG5cdFx0cHJpdmF0ZUV4ZWN1dG9yczogYXdhaXQgUHJpdmF0ZUV4ZWN1dG9yLmZpbmQoe1xuXHRcdFx0cmVsYXRpb25zOiBbJ3VzZXInXSxcblx0XHRcdHdoZXJlOiB7XG5cdFx0XHRcdHVzZXI6IHtcblx0XHRcdFx0XHRsb2dpbjogbG9nZ2VkVXNlci5sb2dpblxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSlcblx0fSk7XG59KTtcbmFwcC5nZXQoJy9yZWdpc3RyYXRvci9saXN0JywgYXN5bmMgKHJlcTogYW55LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblx0Y29uc3QgbG9nZ2VkVXNlciA9IGF3YWl0IGdldExvZ2dlZFVzZXIocmVxKTtcblxuXHRpZihsb2dnZWRVc2VyID09IHVuZGVmaW5lZCkgcmV0dXJuIHJlcy5yZWRpcmVjdCgnL2Vycm9yL3Blcm1pc3Npb24tZGVuaWVkJyk7XG5cblx0cmVzLnJlbmRlcigncGFnZXMvcmVnaXN0cmF0b3ItbGlzdCcsIHtcblx0XHRyb2xlOiBsb2dnZWRVc2VyLnJvbGUsXG5cdFx0cmVnaXN0ZXJzOiBhd2FpdCBVc2VyLmZpbmQoeyB3aGVyZTogeyByb2xlOiAxIH0gfSlcblx0fSk7XG59KTtcbmFwcC5nZXQoJy9ldmVudC1qb3VybmFsJywgYXN5bmMgKHJlcTogYW55LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblx0Y29uc3QgbG9nZ2VkVXNlciA9IGF3YWl0IGdldExvZ2dlZFVzZXIocmVxKTtcblxuXHRpZihsb2dnZWRVc2VyID09IHVuZGVmaW5lZCkgcmV0dXJuIHJlcy5yZWRpcmVjdCgnL2Vycm9yL3Blcm1pc3Npb24tZGVuaWVkJyk7XG5cblx0Y29uc3QgZXZlbnRzID0gYXdhaXQgSm91cm5hbEV2ZW50LmZpbmQoe1xuXHRcdHJlbGF0aW9uczogWyd1c2VyJ10sXG5cdFx0d2hlcmU6IHtcblx0XHRcdHVzZXI6IHtcblx0XHRcdFx0bG9naW46IGxvZ2dlZFVzZXIubG9naW5cblx0XHRcdH1cblx0XHR9LFxuXHRcdG9yZGVyOiB7XG5cdFx0XHRldmVudF9kYXRlOiBcIkRFU0NcIlxuXHRcdH1cblx0fSk7XG5cdFxuXHRyZXMucmVuZGVyKCdwYWdlcy9ldmVudC1qb3VybmFsJywgeyByb2xlOiBsb2dnZWRVc2VyLnJvbGUsIGV2ZW50cyB9KTtcbn0pO1xuYXBwLmdldCgnL3ByaXYtZXhlYy9uZXcnLCBhc3luYyAocmVxOiBhbnksIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRjb25zdCBsb2dnZWRVc2VyID0gYXdhaXQgZ2V0TG9nZ2VkVXNlcihyZXEpO1xuXG5cdGlmKGxvZ2dlZFVzZXIgPT0gdW5kZWZpbmVkKSByZXR1cm4gcmVzLnJlZGlyZWN0KCcvZXJyb3IvcGVybWlzc2lvbi1kZW5pZWQnKTtcblx0XG5cdHJlcy5yZW5kZXIoJ3BhZ2VzL3ByaXYtZXhlYy1uZXcnLCB7IHJvbGU6IGxvZ2dlZFVzZXIucm9sZSwgZGlzdHJpY3RzOiBhd2FpdCBFeGVjdXRpb25EaXN0cmljdC5maW5kKCkgfSk7XG59KTtcbmFwcC5nZXQoJy9wcml2LWV4ZWMvOmlkL2VkaXQnLCBhc3luYyAocmVxOiBhbnksIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRjb25zdCBsb2dnZWRVc2VyID0gYXdhaXQgZ2V0TG9nZ2VkVXNlcihyZXEpO1xuXG5cdGNvbnN0IG9sZFByaXZFeGVjVmFsID0gYXdhaXQgUHJpdmF0ZUV4ZWN1dG9yLmZpbmRPbmUoe1xuXHRcdHdoZXJlOiB7XG5cdFx0XHRpZDogcmVxLnBhcmFtcy5pZFxuXHRcdH0sXG5cdFx0cmVsYXRpb25zOiBbXCJkaXN0cmljdFwiXVxuXHR9KTtcblxuXHRpZihsb2dnZWRVc2VyID09IHVuZGVmaW5lZCB8fCBvbGRQcml2RXhlY1ZhbCA9PSB1bmRlZmluZWQpXG5cdFx0cmV0dXJuIHJlcy5yZWRpcmVjdCgnL2Vycm9yL3Blcm1pc3Npb24tZGVuaWVkJyk7XG5cdFxuXHRyZXMucmVuZGVyKCdwYWdlcy9wcml2LWV4ZWMtZWRpdCcsIHsgcm9sZTogbG9nZ2VkVXNlci5yb2xlLCBvbGRQcml2RXhlY1ZhbCwgZGlzdHJpY3RzOiBhd2FpdCBFeGVjdXRpb25EaXN0cmljdC5maW5kKCkgfSk7XG59KTtcbmFwcC5nZXQoJy9yZWdpc3RyYXRvci9uZXcnLCBhc3luYyAocmVxOiBhbnksIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRjb25zdCBsb2dnZWRVc2VyID0gYXdhaXQgZ2V0TG9nZ2VkVXNlcihyZXEpO1xuXG5cdGlmKGxvZ2dlZFVzZXIgPT0gdW5kZWZpbmVkKSByZXR1cm4gcmVzLnJlZGlyZWN0KCcvZXJyb3IvcGVybWlzc2lvbi1kZW5pZWQnKTtcblxuXHRyZXMucmVuZGVyKCdwYWdlcy9yZWdpc3RyYXRvci1uZXcnLCB7IHJvbGU6IGxvZ2dlZFVzZXIucm9sZSB9KTtcbn0pO1xuYXBwLmdldCgnL3JlZ2lzdHJhdG9yLzpsb2dpbi9lZGl0JywgYXN5bmMgKHJlcTogYW55LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblx0Y29uc3QgbG9nZ2VkVXNlciA9IGF3YWl0IGdldExvZ2dlZFVzZXIocmVxKTtcblxuXHRjb25zdCBvbGRVc2VyVmFsID0gYXdhaXQgVXNlci5maW5kT25lKHJlcS5wYXJhbXMubG9naW4pO1xuXG5cdGlmKGxvZ2dlZFVzZXIgPT0gdW5kZWZpbmVkIHx8IG9sZFVzZXJWYWwgPT0gdW5kZWZpbmVkKVxuXHRcdHJldHVybiByZXMucmVkaXJlY3QoJy9lcnJvci9wZXJtaXNzaW9uLWRlbmllZCcpO1xuXG5cdHJlcy5yZW5kZXIoJ3BhZ2VzL3JlZ2lzdHJhdG9yLWVkaXQnLCB7IHJvbGU6IGxvZ2dlZFVzZXIucm9sZSwgb2xkVXNlclZhbCB9KTtcbn0pO1xuYXBwLmdldCgnL2Vycm9yL3Blcm1pc3Npb24tZGVuaWVkJywgYXN5bmMgKHJlcTogYW55LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblx0Y29uc3QgbG9nZ2VkVXNlciA9IGF3YWl0IGdldExvZ2dlZFVzZXIocmVxKTtcblxuXHRjb25zdCByb2xlID0gKGxvZ2dlZFVzZXIgPT0gdW5kZWZpbmVkKT8gMCA6IGxvZ2dlZFVzZXIucm9sZTtcblxuXHRyZXMucmVuZGVyKCdwYWdlcy9lcnJvcicsIHtyb2xlfSk7XG59KTtcblxuXG5hcHAucG9zdCgnL2FwaS9hdXRoL2xvZ2luJywgYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblx0Y29uc3Qge2xvZ2luLCBwYXNzd29yZH0gPSBKU09OLnBhcnNlKHJlcS5ib2R5KTtcblx0XG5cdGNvbnN0IHVzZXJEYXRhID0gYXdhaXQgVXNlci5maW5kT25lKGxvZ2luKTtcblxuXHRpZih1c2VyRGF0YSAhPSB1bmRlZmluZWQgJiYgdXNlckRhdGEucHdkX2hhc2ggPT0gcGFzc3dvcmQgJiYgdXNlckRhdGEuaXNfYWN0aXZlID09IHRydWUpe1xuXHRcdHJlcy5jb29raWUoY29va2llTmFtZSwgSlNPTi5zdHJpbmdpZnkoe2xvZ2luLCBwYXNzd29yZH0pLCBjb29raWVPcHRpb25zKTtcblxuXHQgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoKTtcblx0fWVsc2V7XG5cdFx0cmVzLnN0YXR1cyg0MDApLnNlbmQoKTtcblx0fVxufSk7XG5hcHAucG9zdCgnL2FwaS9hdXRoL2xvZ291dCcsIGFzeW5jIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG5cdHJlcy5jbGVhckNvb2tpZShjb29raWVOYW1lLCBjb29raWVPcHRpb25zKTtcblxuXHRyZXMuc3RhdHVzKDIwMCkuc2VuZCgpO1xufSk7XG5cblxuYXBwLnBvc3QoJy9hcGkvdXNlcicsIGFzeW5jIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG5cdGNvbnN0IHsgZnVsbG5hbWUsIGFkZGl0aW9uYWxfZGF0YSB9ID0gSlNPTi5wYXJzZShyZXEuYm9keSk7XG5cblx0Y29uc3QgaWRlbnRpZmljYXRpb25EYXRhID0ge1xuXHRcdGxvZ2luOiB1dWlkVjEoKSxcblx0XHRwYXNzd29yZDogdXVpZFY0KClcblx0fTtcblxuXHRpZihhd2FpdCBVc2VyLmZpbmRPbmUoeyBmdWxsbmFtZSB9KSA9PSB1bmRlZmluZWQpe1xuXHRcdGNvbnN0IHVzZXIgPSBuZXcgVXNlcigpO1xuXG5cdFx0dXNlci5sb2dpbiA9IGlkZW50aWZpY2F0aW9uRGF0YS5sb2dpbjtcblx0XHR1c2VyLnB3ZF9oYXNoID0gaWRlbnRpZmljYXRpb25EYXRhLnBhc3N3b3JkO1xuXHRcdHVzZXIuZnVsbG5hbWUgPSBmdWxsbmFtZTtcblx0XHR1c2VyLnJvbGUgPSAxO1xuXHRcdHVzZXIuZGF0ZV9yZWdpc3RyYXRpb24gPSAobmV3IERhdGUoKSkudG9JU09TdHJpbmcoKTtcblx0XHR1c2VyLmlzX2FjdGl2ZSA9IHRydWU7XG5cdFx0dXNlci5hZGRpdGlvbmFsX2RhdGEgPSBhZGRpdGlvbmFsX2RhdGE7XG5cdFx0XG5cdFx0YXdhaXQgdXNlci5zYXZlKCk7XG5cblx0ICAgIHJlcy5qc29uKGlkZW50aWZpY2F0aW9uRGF0YSk7XG5cdH1lbHNle1xuXHRcdHJlcy5zdGF0dXMoNDAwKS5zZW5kKCk7XG5cdH1cbn0pO1xuYXBwLnBvc3QoJy9hcGkvdXNlci86bG9naW4vcmVzX2lkJywgYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblx0Y29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZShyZXEucGFyYW1zLmxvZ2luKTtcblxuXHRpZih1c2VyID09IHVuZGVmaW5lZCl7XG5cdFx0cmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKCk7XG5cdH1cblxuXHR1c2VyLmxvZ2luID0gdXVpZFYxKCk7XG5cdHVzZXIucHdkX2hhc2ggPSB1dWlkVjQoKTtcblx0XG5cdGF3YWl0IHVzZXIuc2F2ZSgpO1xuXG4gICAgcmVzLnN0YXR1cygyMDApLnNlbmQoKTtcbn0pO1xuYXBwLnB1dCgnL2FwaS91c2VyLzpsb2dpbicsIGFzeW5jIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG5cdGNvbnN0IHsgZnVsbG5hbWUsIGFkZGl0aW9uYWxfZGF0YSwgaXNfYWN0aXZlIH0gPSBKU09OLnBhcnNlKHJlcS5ib2R5KTtcblxuXHRjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHJlcS5wYXJhbXMubG9naW4pO1xuXG5cdGlmKHVzZXIgPT0gdW5kZWZpbmVkKXtcblx0XHRyZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoKTtcblx0fVxuXG5cdGlmKGZ1bGxuYW1lICE9IHVuZGVmaW5lZCkgdXNlci5mdWxsbmFtZSA9IGZ1bGxuYW1lO1xuXHRpZihpc19hY3RpdmUgIT0gdW5kZWZpbmVkKSB1c2VyLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcblx0aWYoYWRkaXRpb25hbF9kYXRhICE9IHVuZGVmaW5lZCkgdXNlci5hZGRpdGlvbmFsX2RhdGEgPSBhZGRpdGlvbmFsX2RhdGE7XG5cdFxuXHRhd2FpdCB1c2VyLnNhdmUoKTtcblxuICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKCk7XG59KTtcbmFwcC5kZWxldGUoJy9hcGkvdXNlci86bG9naW4nLCBhc3luYyAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRhd2FpdCBVc2VyLnJlbW92ZShyZXEucGFyYW1zLmxvZ2luKTtcblxuICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKCk7XG59KTtcblxuXG5hcHAucG9zdCgnL2FwaS9wcml2LWV4ZWMnLCBhc3luYyAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRjb25zdCB7IFxuXHRcdGZ1bGxuYW1lLCBkaXN0cmljdF9pZCwgY2VydGlmaWNhdGVfbnVtLFxuXHRcdHJlY19jZXJ0aWZfb24sIG9mZmljZV9hZGRyLCBzdGFydGVkX291dF9vblxuXHR9ID0gSlNPTi5wYXJzZShyZXEuYm9keSk7XG5cdGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRMb2dnZWRVc2VyKHJlcSk7XG5cblx0Y29uc29sZS5sb2coSlNPTi5wYXJzZShyZXEuYm9keSkpO1xuXG5cdGlmKGF3YWl0IFByaXZhdGVFeGVjdXRvci5maW5kT25lKHsgZnVsbG5hbWUgfSkgPT0gdW5kZWZpbmVkKXtcblx0XHRjb25zdCBwcml2RXhlYyA9IG5ldyBQcml2YXRlRXhlY3V0b3IoKTtcblxuXHRcdHByaXZFeGVjLmZ1bGxuYW1lID0gZnVsbG5hbWU7XG5cdFx0cHJpdkV4ZWMudXNlciA9IHVzZXI7XG5cdFx0cHJpdkV4ZWMuZGlzdHJpY3QgPSBhd2FpdCBFeGVjdXRpb25EaXN0cmljdC5maW5kT25lKE51bWJlcihkaXN0cmljdF9pZCkpO1xuXHRcdHByaXZFeGVjLmlzX2FjdGl2ZSA9IHRydWU7XG5cdFx0cHJpdkV4ZWMuY3JlYXRlZF9vbiA9IChuZXcgRGF0ZSgpKS50b0lTT1N0cmluZygpO1xuXHRcdHByaXZFeGVjLmNlcnRpZmljYXRlX251bSA9IGNlcnRpZmljYXRlX251bTtcblx0XHRwcml2RXhlYy5yZWNfY2VydGlmX29uID0gcmVjX2NlcnRpZl9vbjtcblx0XHRwcml2RXhlYy5vZmZpY2VfYWRkciA9IG9mZmljZV9hZGRyO1xuXHRcdHByaXZFeGVjLnN0YXJ0ZWRfb3V0X29uID0gc3RhcnRlZF9vdXRfb247XG5cdFx0XG5cdFx0YXdhaXQgcHJpdkV4ZWMuc2F2ZSgpO1xuXG5cdCAgICByZXMuc3RhdHVzKDIwMCkuc2VuZCgpO1xuXHR9ZWxzZXtcblx0XHRyZXMuc3RhdHVzKDQwMCkuc2VuZCgpO1xuXHR9XG59KTtcbmFwcC5wdXQoJy9hcGkvcHJpdi1leGVjLzppZCcsIGFzeW5jIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG5cdGNvbnN0IHsgXG5cdFx0ZnVsbG5hbWUsIGRpc3RyaWN0X2lkLCBjZXJ0aWZpY2F0ZV9udW0sXG5cdFx0cmVjX2NlcnRpZl9vbiwgb2ZmaWNlX2FkZHIsIHN0YXJ0ZWRfb3V0X29uLFxuXHRcdGlzX2FjdGl2ZVxuXHR9ID0gSlNPTi5wYXJzZShyZXEuYm9keSk7XG5cblx0Y29uc3QgcHJpdkV4ZWMgPSBhd2FpdCBQcml2YXRlRXhlY3V0b3IuZmluZE9uZShyZXEucGFyYW1zLmlkKTtcblxuXHRpZihwcml2RXhlYyA9PSB1bmRlZmluZWQpe1xuXHRcdHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCgpO1xuXHR9XG5cblx0aWYoZnVsbG5hbWUgIT0gdW5kZWZpbmVkKSBwcml2RXhlYy5mdWxsbmFtZSA9IGZ1bGxuYW1lO1xuXHRpZihkaXN0cmljdF9pZCAhPSB1bmRlZmluZWQpIHByaXZFeGVjLmRpc3RyaWN0ID0gYXdhaXQgRXhlY3V0aW9uRGlzdHJpY3QuZmluZE9uZShOdW1iZXIoZGlzdHJpY3RfaWQpKTtcblx0aWYoY2VydGlmaWNhdGVfbnVtICE9IHVuZGVmaW5lZCkgcHJpdkV4ZWMuY2VydGlmaWNhdGVfbnVtID0gY2VydGlmaWNhdGVfbnVtO1xuXHRpZihyZWNfY2VydGlmX29uICE9IHVuZGVmaW5lZCkgcHJpdkV4ZWMucmVjX2NlcnRpZl9vbiA9IHJlY19jZXJ0aWZfb247XG5cdGlmKG9mZmljZV9hZGRyICE9IHVuZGVmaW5lZCkgcHJpdkV4ZWMub2ZmaWNlX2FkZHIgPSBvZmZpY2VfYWRkcjtcblx0aWYoc3RhcnRlZF9vdXRfb24gIT0gdW5kZWZpbmVkKSBwcml2RXhlYy5zdGFydGVkX291dF9vbiA9IHN0YXJ0ZWRfb3V0X29uO1xuXHRpZihpc19hY3RpdmUgIT0gdW5kZWZpbmVkKSBwcml2RXhlYy5pc19hY3RpdmUgPSBpc19hY3RpdmU7XG5cdFxuXHRhd2FpdCBwcml2RXhlYy5zYXZlKCk7XG5cbiAgICByZXMuc3RhdHVzKDIwMCkuc2VuZCgpO1xufSk7XG5hcHAuZGVsZXRlKCcvYXBpL3ByaXYtZXhlYy86aWQnLCBhc3luYyAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHRhd2FpdCBQcml2YXRlRXhlY3V0b3IucmVtb3ZlKHJlcS5wYXJhbXMuaWQpO1xuXG4gICAgcmVzLnN0YXR1cygyMDApLnNlbmQoKTtcbn0pO1xuXG5cbmFwcC51c2UoKGVycjogRXJyb3IsIHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXNwOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBGdW5jdGlvbik9Pntcblx0Y29uc29sZS5sb2coZXJyKTtcblx0cmVzcC5zdGF0dXMoNTAwKS5zZW5kKCdFUlJPUicpO1xufSk7XG5cbnByb2Nlc3Mub24oJ1NJR0lOVCcsYXN5bmMgKCkgPT4gKGF3YWl0IGNvbm5lY3Rpb25Qcm9taXNlKS5jbG9zZSgpLnRoZW4oKCkgPT4gcHJvY2Vzcy5leGl0KCkpKTtcblxuKGFzeW5jIGZ1bmN0aW9uKCl7XG5cdGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBjb25uZWN0aW9uUHJvbWlzZTtcblx0Ly9hd2FpdCBjb25uZWN0aW9uLnN5bmNocm9uaXplKCk7XG5cblx0YXBwLmxpc3Rlbihwcm9jZXNzLmVudi5QT1JUIHx8IDUwMDAsICgpID0+IHtcblx0XHRjb25zb2xlLmxvZyhcIlN0YXJ0ZWQgc2VydmVyIVwiKTtcblx0fSk7XG59KSgpOyJdfQ==